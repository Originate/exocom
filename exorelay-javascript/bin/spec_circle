#!/usr/bin/env bash
set -e

# transpile
node_modules/o-tools-livescript/bin/build

# run linter
bin/lint

# run unit tests
MOCHA_FILE="$CIRCLE_TEST_REPORTS/Mocha/exorelay-javascript-unit-tests.xml" mocha --compilers ls:livescript "**/*spec.ls" --reporter mocha-circleci-reporter

mkdir -p "$CIRCLE_TEST_REPORTS/cucumber"
node_modules/.bin/cucumber-js --format "json:$CIRCLE_TEST_REPORTS/cucumber/exorelay-javascript-cucumber.cucumber" --format pretty
